# How_to_use_AWS_Cognito_Android_SDK_with_Kotlin

概要
AWS Cognito認証機能を利用して、既存のAWSユーザープールを使用し
Android向けのユーザーログイン機能をKotlinで実装する簡単な方法。

※今回はAWS Amplifyを使用しない方法での説明
2023年1月現在でAWS公式はAmplifyを今後の主流として推奨しているようなので、
aws-android-sdk(旧型)ではなくAmplifyを使用する実装の方が望ましいかもしれない。
単純に認証機能を実装したいだけであれば、aws-android-sdkで十分かもしれない。

参考　AWS公式
https://aws.amazon.com/jp/blogs/mobile/using-android-sdk-with-amazon-cognito-your-user-pools/

AWS Cognito認証機能の大枠についての説明
※混乱しやすい部分について
大雑把に言うと、Cognito認証にはユーザープールとIDプールという二段階の認証システムがあり、
まずユーザープールを使用した認証によってIDトークンを取得し(一段階目)、
取得したIDトークンと設定したCognitoCredentialsProviderの2つを使用して
IDプールの認証を行うことができる(二段階目)。

単純なログイン機能だけであれば、ユーザープールを使用した認証の実装までで実現できる。
ユーザープールの認証成功時に、IDトークン、アクセストークン、更新トークンの3つを取得するが、
IDトークンは
json形式で、内部にユーザープールに登録されたユーザー情報を保持しており、
IDプールの認証に使用する以外にも、IDトークンそのものをデコードしてユーザー情報を取得することもできる。

アクセストークンは
主にユーザープールに登録されたユーザー情報の変更時に使用する。

更新トークンは
サインインが成功した状態を保持して自動的に更新するために使用する。

IDプールについて
IDプールの認証に成功したユーザーはAWSのサービスやデータベース、APIなどにアクセスが可能であり、
つまりIDプールを使用することで、疑似的にAWSアクセスキーが必要なサービスにアクセスできる。
そのためIDプールの使用のためには、CognitoCredentialsProviderに
1、AWSアクセスキー
2、AWSアクセスキーから生成したプロファイル情報
3、AWS IAMで設定したロール情報
のいずれかを設定する必要があり、セキュリティ的に注意が必要である。

IDプールまで使用したシステムを実装したい場合、Amplifyを使用して実装することで、全て自作するより
セキュリティ的に比較的安全な方法をAmplifyが実現してくれるらしい。
